!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("GridPhysics",[],t):"object"==typeof exports?exports.GridPhysics=t():e.GridPhysics=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.map=null,i.animatedTiles=[],i.rate=1,i.active=!1,i.activeLayer=[],i.followTimeScale=!0,e.sys.settings.isBooted||e.sys.events.once("boot",i.boot,i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Phaser.Plugins.ScenePlugin),i(t,[{key:"boot",value:function(){var e=this.systems.events;e.on("postupdate",this.postUpdate,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this)}},{key:"init",value:function(e){var t={map:e,animatedTiles:this.getAnimatedTiles(e),active:!0,rate:1,activeLayer:[]};e.layers.forEach(function(){return t.activeLayer.push(!0)}),this.animatedTiles.push(t),1===this.animatedTiles.length&&(this.active=!0)}},{key:"setRate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===t)null===n?this.rate=e:this.animatedTiles[n].rate=e;else{var i=function(n){n.forEach(function(n){n.index===t&&(n.rate=e)})};null===n?this.animatedTiles.forEach(function(e){i(e.animatedTiles)}):i(this.animatedTiles[n].animatedTiles)}}},{key:"resetRates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?(this.rate=1,this.animatedTiles.forEach(function(e){e.rate=1,e.animatedTiles.forEach(function(e){e.rate=1})})):(this.animatedTiles[e].rate=1,this.animatedTiles[e].animatedTiles.forEach(function(e){e.rate=1}))}},{key:"resume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=null===n?this:this.animatedTiles[n];null===t?i.active=!0:(i.activeLayer[t]=!0,i.animatedTiles.forEach(function(n){e.updateLayer(n,n.tiles[t])}))}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===t?this:this.animatedTiles[t];null===e?n.active=!1:n.activeLayer[e]=!1}},{key:"postUpdate",value:function(e,t){var n=this;if(this.active){var i=t*this.rate*(this.followTimeScale?this.scene.time.timeScale:1);this.animatedTiles.forEach(function(e){if(e.active){var t=i*e.rate;e.animatedTiles.forEach(function(i){if(i.next-=t*i.rate,i.next<0){var a=i.currentFrame,r=i.frames[a].tileid,o=a+1;o>i.frames.length-1&&(o=0),i.next=i.frames[o].duration,i.currentFrame=o,i.tiles.forEach(function(t,a){e.activeLayer[a]&&n.updateLayer(i,t,r)})}})}})}}},{key:"updateLayer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=[],a=e.frames[e.currentFrame].tileid;t.forEach(function(e){n>-1&&(null===e||e.index!==n)?i.push(e):e.index=a}),i.forEach(function(e){var n=t.indexOf(e);n>-1?t.splice(n,1):console.error("This shouldn't happen. Not at all. Blame Phaser Animated Tiles plugin. You'll be fine though.")})}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"getAnimatedTiles",value:function(e){var t=this,n=[];return e.tilesets.forEach(function(t){var i=t.tileData;Object.keys(i).forEach(function(a){if(a=parseInt(a),i[a].hasOwnProperty("animation")){var r={index:a+t.firstgid,frames:[],currentFrame:0,tiles:[],rate:1};i[a].animation.forEach(function(e){var n={duration:e.duration,tileid:e.tileid+t.firstgid};r.frames.push(n)}),r.next=r.frames[0].duration,e.layers.forEach(function(e){if("StaticTilemapLayer"!==e.tilemapLayer.type){var n=[];e.data.forEach(function(e){e.forEach(function(e){e.index-t.firstgid===a&&n.push(e)})}),r.tiles.push(n)}else r.tiles.push([])}),n.push(r)}})}),e.layers.forEach(function(e,n){t.activeLayer[n]=!0}),n}},{key:"putTileAt",value:function(e,t,n,i){}},{key:"updateAnimatedTiles",value:function(){var e=null;null===e&&(e=[],this.animatedTiles.forEach(function(t){e.push(t)})),e.forEach(function(e){e.animatedTiles.forEach(function(t){t.tiles.forEach(function(n,i){if("StaticTilemapLayer"!==e.map.layers[i].type)for(var a=0;a<10;a++)for(var r=0;r<10;r++){var o=e.map.layers[i].data[a][r];o.index==t.index&&(-1===n.indexOf(o)&&n.push(o),o.index=t.frames[t.currentFrame].tileid)}})})})}}]),t}();a.register=function(e){e.register("AnimatedTiles",a,"animatedTiles")},e.exports=a}])});